<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.luna_code.mapper.UserMapper">

	<!-- 프로필 정보 조회 쿼리 -->
	<select id="selectUserProfile" parameterType="string" resultType="com.itwillbs.luna_code.vo.UserVO">
		SELECT
			   user_id
			,  user_name
			,  nickname
			,  email
			,  phone
			,  bio
			,  github_url
			,  profile_img
		  FROM member
		 WHERE user_id = #{user_id}
	</select>

	<!-- 프로필 정보 업데이트 쿼리 -->
	<update id="updateUserProfile" parameterType="com.itwillbs.luna_code.vo.UserVO">
		UPDATE member
		<!-- <set> 태그는 SET 구문 안의 마지막 콤마(,)를 자동으로 제거해줍니다. -->
		<set>
			  nickname = #{nickname},
			       bio = #{bio},
			github_url = #{github_url}
			<!-- 
				profile_img 필드가 null이 아니고 비어있지 않을 때만 
				(즉, 새 이미지가 업로드되었을 때만) 이 구문을 쿼리에 포함시킵니다.
			-->
			<if test="profile_img != null and profile_img != ''">
				, profile_img = #{profile_img}
			</if>
		</set>
		WHERE user_id = #{user_id}
	</update>

	<!-- 닉네임 개수 조회 쿼리 (중복 확인용) -->
	<select id="countNickname" parameterType="string" resultType="int">
		SELECT COUNT(*) 
		  FROM member
		 WHERE nickname = #{nickname}
	</select>

	<!-- userId에 해당하는 비밀번호 조회 -->
	<select id="selectPassword" resultType="string">
		SELECT password
		  FROM member
		 WHERE user_id = #{user_id}
	</select>

	<!-- userId에 해당하는 회원의 비밀번호를 새 비밀번호로 업데이트 -->
	<update id="updatePassword">
		UPDATE member
		   SET password = #{newPassword}
		 WHERE user_id = #{user_id}
	</update>

	<delete id="deleteUser">
		DELETE 
		  FROM member
		 WHERE user_id = #{user_id}
	</delete>

</mapper>
