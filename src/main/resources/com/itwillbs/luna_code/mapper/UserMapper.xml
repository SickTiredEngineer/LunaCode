<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<!-- 
    mapper 태그의 namespace 속성은 위 UserMapper.java 인터페이스의 
    패키지 경로를 포함한 전체 이름과 반드시 일치해야 합니다.
-->   
<mapper namespace="com.itwillbs.luna_code.mapper.UserMapper">
   
   <!-- 1. 프로필 정보 조회 쿼리 -->
    <!-- id는 UserMapper.java의 메소드 이름과 일치해야 합니다. -->
   <select id="selectUserProfile" parameterType="string" resultType="com.itwillbs.luna_code.vo.UserVO">
      SELECT
              user_id, 
              user_name, 
              nickname, 
              email, 
              phone, 
              bio, 
              github_url, 
              profile_img
        FROM  member
       WHERE  user_id = #{userId}
   </select>
   
   <!-- 2. 프로필 정보 업데이트 쿼리 -->
   <update id="updateUserProfile" parameterType="com.itwillbs.luna_code.vo.UserVO">
       UPDATE member
       <!-- <set> 태그는 SET 구문 안의 마지막 콤마(,)를 자동으로 제거해줍니다. -->
       <set>
           nickname   = #{nickname},
           bio        = #{bio},
           github_url = #{github_url}
           <!-- 
               profile_img 필드가 null이 아니고 비어있지 않을 때만 
               (즉, 새 이미지가 업로드되었을 때만) 이 구문을 쿼리에 포함시킵니다.
           -->
           <if test="profile_img != null and profile_img != ''">
               , profile_img = #{profile_img}
           </if>
       </set>
       WHERE user_id = #{user_id}
   </update>
    
    <!-- 3. 닉네임 개수 조회 쿼리 (중복 확인용) -->
    <select id="countNickname" parameterType="string" resultType="int">
        SELECT COUNT(*) 
          FROM member
         WHERE nickname = #{nickname}
    </select>
    
</mapper>