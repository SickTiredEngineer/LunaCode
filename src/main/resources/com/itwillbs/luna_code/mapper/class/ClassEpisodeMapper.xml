<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.luna_code.mapper.ClassEpisodeMapper">

    <insert id="insertClassEpisode" parameterType="com.itwillbs.luna_code.vo.ClassEpisodeVo" >
	  INSERT INTO class_episode (
	    session_idx, 
	    episode_name
	) VALUES (
	 	#{session_idx}, 
	 	#{episode_name}
	)
	</insert>
	
	<select id="selectEpisodesBySessionId" parameterType="com.itwillbs.luna_code.vo.ClassEpisodeVo">
	    SELECT episode_idx, session_idx, episode_name
	    FROM class_episode
	    WHERE session_idx = #{sessionIdx}
	</select>
	
	<update id="updateEpisode" parameterType="com.itwillbs.luna_code.vo.ClassEpisodeVo">
	    UPDATE class_episode
	    SET episode_name = #{episode_name}
	    WHERE episode_idx = #{episode_idx}
	</update>
	
	 <delete id="deleteEpisode" parameterType="int">
        DELETE FROM class_episode WHERE episode_idx = #{episode_idx}
    </delete>

    <!--  특정 클래스의 모든 에피소드 삭제 -->
    <delete id="deleteEpisodesByClassId" parameterType="int">
        DELETE FROM class_episode 
        WHERE session_idx IN (
            SELECT session_idx FROM class_session WHERE class_idx = #{classId}
        )
    </delete>

    <!--  특정 세션의 모든 에피소드 삭제 -->
    <delete id="deleteEpisodesBySessionId" parameterType="int">
        DELETE FROM class_episode WHERE session_idx = #{sessionId}
    </delete>
    
    <!-- 에피소드 조회 -->
	<select id="selectEpisodeById" parameterType="int" resultType="com.itwillbs.luna_code.vo.ClassEpisodeVo">
	    SELECT 
	        episode_idx,
	        session_idx,
	        episode_name,
	        episode_index,
	        episode_video_path,
	        episode_description
	    FROM class_episode
	    WHERE episode_idx = #{episode_idx}
	</select>

	
	<!-- 에피소드 수정 -->
	<update id="updateEpisodeDetail" parameterType="com.itwillbs.luna_code.vo.ClassEpisodeVo">
	    UPDATE class_episode
	    SET
	        episode_name = #{episode_name},
	        episode_video_path = #{episode_video_path},
	        episode_description = #{episode_description},
	        episode_index = #{episode_index}
	    WHERE episode_idx = #{episode_idx}
	</update>
	
	<!-- 	온라인 강의 에피소드 -->
	<select id="selectEpisodeList">
    	SELECT episode_name, episode_video_path, session_idx
    	FROM class_episode
    	ORDER BY session_idx 
	</select>
	








	
</mapper>